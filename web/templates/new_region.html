{% extends "logged_in.html" %}
{% block script %}
<script>
    function submit_county(){
        console.log("Loading regions...");

        var value = document.getElementById('county').value;
        $.ajax(
                {
                    url: '/get/regions',
                    method: 'POST',
                    data: value,
                    success: function(data) {
                        var regions = JSON.parse(data);
                        for(var i=0; i < regions.length; i++) {
                            var opt = document.createElement("option");
                            opt.value=regions[i][0];
                            opt.innerHTML = regions[i][1];

                            document.getElementById('region').add(opt);
                        }
                    },
                    failure: function(data) {
                        console.log("No county selected; not updating region dropdown")
                    },
                }
              );
    };
</script>
{% endblock %}
{% block main_content %}
      <h1>Subscribe to a region:</h1>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class=flashes>
          {% for message in messages %}
            <li>{{ message }}</li>
          {% endfor %}
          </ul>
        {% endif %}
      {% endwith %}

      <form method="POST" action="/new_region">
        {{ form.csrf_token }}
        {{ form.county.label }} {{ form.county(onchange="submit_county()") }}<br>
        {{ form.region.label }} {{ form.region() }}<br>
        {{ form.property_type.label }} {{ form.property_type() }}<br>
        <input type="submit" value="Subscribe">
      </form>
{% endblock %}
